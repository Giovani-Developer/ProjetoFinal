<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Controle de Despesas</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
  <div class="container mt-5">

    <!-- Mensagens flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'danger' else 'success' }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <h1 class="mb-3 text-center">ðŸ’° Controle de Despesas</h1>

    <a href="/add" class="btn btn-success mb-3">+ Adicionar Despesa</a>

    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>DescriÃ§Ã£o</th>
          <th>Categoria</th>
          <th>Valor (R$)</th>
          <th>Data</th>
          <th>AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody>
        {% for expense in expenses %}
        <tr>
          <td>{{ expense.description }}</td>
          <td>{{ expense.category }}</td>
          <td>{{ '%.2f' | format(expense.value) }}</td>
          <td>{{ expense.date.strftime('%d/%m/%Y') }}</td>
          <td>
            <a href="{{ url_for('edit', id=expense.id) }}" class="btn btn-warning btn-sm">Editar</a>
            <a href="{{ url_for('delete', id=expense.id) }}" class="btn btn-danger btn-sm">Excluir</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <h4 class="text-end">ðŸ’µ Total: R$ {{ '%.2f' | format(total) }}</h4>

    <!-- GrÃ¡fico -->
    <div class="card p-4 mt-5 shadow-sm">
      <h5 class="text-center mb-3">ðŸ“Š Despesas por Categoria</h5>
      <canvas id="chart"></canvas>
    </div>

  </div>

 <script>
  // VariÃ¡veis vindas do Flask
  var categories = JSON.parse('{{ categories|tojson|safe }}');
  var totals = JSON.parse('{{ totals|tojson|safe }}');

  if (categories && categories.length > 0) {
    var ctx = document.getElementById('chart').getContext('2d');
    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: categories,
        datasets: [{
          data: totals,
          backgroundColor: [
            '#36A2EB', '#FF6384', '#FFCE56',
            '#4BC0C0', '#9966FF', '#FF9F40',
            '#A4DE02', '#00C49F'
          ]
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' }
        }
      }
    });
  }
</script>


  <script src="https://cdn.jsdelivr.net/npm/bootst
